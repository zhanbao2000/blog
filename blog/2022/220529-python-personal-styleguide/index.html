
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="这是一篇简要的 Python 代码风格指导，代表了我个人所倾向的代码风格。使用这些风格可以让你的代码看起来更 Pythonic，更精炼地描述你代码所作的工作，或许也可以减轻你的重构压力。">
      
      
        <meta name="author" content="Akiba Arisa">
      
      
        <link rel="canonical" href="https://blog.arisa.moe/blog/2022/220529-python-personal-styleguide/">
      
      
        <link rel="prev" href="../220511-how-to-write-python-into-classical-chinese/">
      
      
        <link rel="next" href="../220530-auto-sign-in-guide/">
      
      
      <link rel="icon" href="../../../assets/favicon.webp">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>Python 个人代码风格指导 - Arisa | Blog</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/custom.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="Arisa | Blog" class="md-header__button md-logo" aria-label="Arisa | Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 1h12.5c.966 0 1.75.784 1.75 1.75v8.5A1.75 1.75 0 0 1 14.25 13H8.061l-2.574 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25v-8.5C0 1.784.784 1 1.75 1M1.5 2.75v8.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.75.75 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-8.5a.25.25 0 0 0-.25-.25H1.75a.25.25 0 0 0-.25.25m5.28 1.72a.75.75 0 0 1 0 1.06L5.31 7l1.47 1.47a.75.75 0 0 1-.018 1.042.75.75 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.75.75 0 0 1 1.06 0m2.44 0a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.75.75 0 0 1-1.042-.018.75.75 0 0 1-.018-1.042L10.69 7 9.22 5.53a.75.75 0 0 1 0-1.06"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Arisa | Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Python 个人代码风格指导
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="跟随系统"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="跟随系统" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="亮色模式"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="亮色模式" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="暗色模式"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="暗色模式" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/zhanbao2000/blog" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    zhanbao2000/blog
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  主页

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../expand/" class="md-tabs__link">
        
  
  
    
  
  扩列

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../tags/" class="md-tabs__link">
        
  
  
    
  
  标签

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../toc/" class="md-tabs__link">
        
  
  
    
  
  目录

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../220406-nginx-stream/" class="md-tabs__link">
          
  
  
  Blog

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Arisa | Blog" class="md-nav__button md-logo" aria-label="Arisa | Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 1h12.5c.966 0 1.75.784 1.75 1.75v8.5A1.75 1.75 0 0 1 14.25 13H8.061l-2.574 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25v-8.5C0 1.784.784 1 1.75 1M1.5 2.75v8.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.75.75 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-8.5a.25.25 0 0 0-.25-.25H1.75a.25.25 0 0 0-.25.25m5.28 1.72a.75.75 0 0 1 0 1.06L5.31 7l1.47 1.47a.75.75 0 0 1-.018 1.042.75.75 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.75.75 0 0 1 1.06 0m2.44 0a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.75.75 0 0 1-1.042-.018.75.75 0 0 1-.018-1.042L10.69 7 9.22 5.53a.75.75 0 0 1 0-1.06"/></svg>

    </a>
    Arisa | Blog
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/zhanbao2000/blog" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    zhanbao2000/blog
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    主页
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../expand/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    扩列
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    标签
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../toc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    目录
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" checked>
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    2022
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            2022
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../220406-nginx-stream/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    nginx 如何设置 stream 转发
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../220406-set-http-proxy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    解决使用代理后 pip 和 python 无法连接到网络的问题
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../220406-venv-move-file/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    移动 python 项目文件夹位置后如何解决 PyCharm 找不到解释器与无法正常使用终端的问题
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../220407-certbot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    certbot 常用操作
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../220407-github-pages/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GitHub Pages 文档自动化部署 - MkDocs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../220408-github-pages-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GitHub Pages 文档自动化部署 - VuePress
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../220409-cloudflare-workers-arcaea-update/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    如何使用 Cloudflare Workers 来搭建 Arcaea 镜像下载服务器
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../220412-ida-substitute-usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IDA 替换二进制文件
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../220413-Intranet-penetration-bitcomit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    利用内网穿透和代理获取公网 IP 地址解决比特彗星黄灯
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../220414-fk-arcaea-songlist-hash/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    解除 Arcaea 对 songlist 等文件的哈希校验
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../220416-arcaea-fanmade-chart-problem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Arcaea 自制谱移植常见问题
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../220417-linux-clean-up-disk-space/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linux 清理磁盘空间常见操作
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../220421-use-gzip-bomb-against-scanner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    如何使用 gzip 压缩包炸弹对恶意扫描器进行反击
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../220428-how-to-ask-questions-like-a-retard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    如何像一个弱智一样提问
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../220429-dilb-ultimate-solution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    基于 Anaconda 的 dlib（CUDA 版本）安装的终极解决方案
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../220502-how-dogs-work-in-epic7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    第七史诗升六星的正确理解
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../220511-how-to-write-python-into-classical-chinese/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    如何将 Python 写成文言文
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Python 个人代码风格指导
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Python 个人代码风格指导
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      一、绪论
    </span>
  </a>
  
    <nav class="md-nav" aria-label="一、绪论">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-python-import-this" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 Python 之禅：import this
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-pep-8" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 PEP-8
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      二、该使用什么
    </span>
  </a>
  
    <nav class="md-nav" aria-label="二、该使用什么">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 使用合适的对象作为数据结构
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 积极使用类型注释
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 函数的功能应具有专一性
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      三、该取代什么
    </span>
  </a>
  
    <nav class="md-nav" aria-label="三、该取代什么">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 使用优美的现有方法取代丑陋的自行实现
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 使用括号换行取代换行符换行
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-python" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 使用 Python 习语取代某些自行实现
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      四、该避免什么
    </span>
  </a>
  
    <nav class="md-nav" aria-label="四、该避免什么">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 避免迷惑命名
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 避免过长的函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 避免在多个函数里构造一样的代码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44-try-except" class="md-nav__link">
    <span class="md-ellipsis">
      4.4 避免滥用 try except 语句
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#45" class="md-nav__link">
    <span class="md-ellipsis">
      4.5 不要消化自己不该处理的错误
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#46" class="md-nav__link">
    <span class="md-ellipsis">
      4.6 不要为了炫技而故意降低代码可读性
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../220530-auto-sign-in-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    自动签到使用指南
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../220602-ipv6-bypass-billing-system/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    架设双栈代理服务器通过 IPv6 绕过校园网计费系统的方法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../220902-python-mutable-defaults/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Python 默认参数可变的危险性
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../220913-python-confusing-detail/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Python 中令人迷惑的细节
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../221113-rclone-sharepoint-for-hentai-at-home/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    使用 Rclone 挂载 SharePoint 作为 Hentai@Home 的缓存目录
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../221113-rclone-sharepoint-oauth-failed/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    通过 WebDAV 解决 Rclone 挂载 SharePoint 时遇到 Error: Auth Error
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../221115-issue-of-position-or-right-and-wrong/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    立场问题与是非问题
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    2023
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            2023
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2023/230113-my-2022-website/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    我的浏览器 2022 年度总结
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2023/230114-matrix-qq-wechat-bridge/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    通过 Matrix 协议实现代理接收 QQ 和微信消息 —— 从入坑到入土
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2023/230309-pycharm-git-submodule/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    如何在 PyCharm 中使用 Git Submodule
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2023/230406-pillow-affine-args/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    （Pillow）Affine 图形变换的矩阵参数详解
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2023/230428-mokabot-arcaea/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    mokabot 的 Arcaea 模块发展史
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2023/230504-chart-analysis-425ex/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    《SWITCH ON NOW》 AP 解析
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2023/230512-arcaea-webapi-archive/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    （存档）什么是 webapi 查分方案
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    2024
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            2024
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024/240611-python-asynchronous/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    从协程、任务和 Future 入门 Python 异步 I/O
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024/241012-ubuntu-2404-multi-vm-networking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ubuntu 24.04 多虚拟机组网
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024/241013-hadoop-cluster-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hadoop 3.4.0 集群搭建教程
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024/241114-google-scholar-403/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    使用 Cloudflare WARP 解决 Google Scholar 403 问题
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024/241126-google-drive-rclone-webdav/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    使用 rclone 为 Google Drive 提供 WebDAV 访问方式
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    2024 leetcode clock event
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            2024 leetcode clock event
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024-leetcode-clock-event/241024-3175/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3175. 找到连续赢 K 场比赛的第一位玩家
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024-leetcode-clock-event/241025-3180/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3180. 执行操作可获得的最大总奖励 I
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024-leetcode-clock-event/241026-3181/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3181. 执行操作可获得的最大总奖励 II
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024-leetcode-clock-event/241027-684/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    684. 冗余连接
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024-leetcode-clock-event/241028-685/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    685. 冗余连接 II
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024-leetcode-clock-event/241029-3211/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3211. 生成不含相邻零的二进制字符串
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024-leetcode-clock-event/241030-3216/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3216. 交换后字典序最小的字符串
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024-leetcode-clock-event/241101-3259/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3259. 超级饮料的最大强化能量
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024-leetcode-clock-event/241102-3226/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3226. 使两个整数相等的位更改次数
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024-leetcode-clock-event/241103-638/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    638. 大礼包
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024-leetcode-clock-event/241104-633/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    633. 平方数之和
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024-leetcode-clock-event/241105-3222/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3222. 求出硬币游戏的赢家
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024-leetcode-clock-event/241106-3254/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3254. 长度为 K 的子数组的能量值 I
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024-leetcode-clock-event/241107-3255/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3255. 长度为 K 的子数组的能量值 II
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024-leetcode-clock-event/241109-3242/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3242. 设计相邻元素求和服务
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024-leetcode-clock-event/241110-540/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    540. 有序数组中的单一元素
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024-leetcode-clock-event/241111-1547/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1547. 切棍子的最小成本
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2024-leetcode-clock-event/241112-3258/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3258. 统计满足 K 约束的子字符串数量 I
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    2025
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            2025
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2025/250217-fix-steamdeck-visual-novel-video/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    使用 Protontricks 修复 Steam Deck 上部分视觉小说无法播放视频的问题
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2025/250406-amend-old-commit-interactively-rebase/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    使用交互式变基修正旧的提交 - 基于 PyCharm Git 插件
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2025/250606-python-folder-share/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    使用 Python 一键在 Windows 上共享文件夹
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2025/250611-steamdeck-battery-black-screen-fix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Steam Deck 因电池耗尽而黑屏，充电却再也无法开机的解决方法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2025/250613-steamdeck_proxy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Steam Deck 手机热点代理及其设置方法
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      一、绪论
    </span>
  </a>
  
    <nav class="md-nav" aria-label="一、绪论">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-python-import-this" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 Python 之禅：import this
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-pep-8" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 PEP-8
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      二、该使用什么
    </span>
  </a>
  
    <nav class="md-nav" aria-label="二、该使用什么">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 使用合适的对象作为数据结构
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 积极使用类型注释
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 函数的功能应具有专一性
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      三、该取代什么
    </span>
  </a>
  
    <nav class="md-nav" aria-label="三、该取代什么">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 使用优美的现有方法取代丑陋的自行实现
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 使用括号换行取代换行符换行
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-python" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 使用 Python 习语取代某些自行实现
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      四、该避免什么
    </span>
  </a>
  
    <nav class="md-nav" aria-label="四、该避免什么">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 避免迷惑命名
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 避免过长的函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 避免在多个函数里构造一样的代码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44-try-except" class="md-nav__link">
    <span class="md-ellipsis">
      4.4 避免滥用 try except 语句
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#45" class="md-nav__link">
    <span class="md-ellipsis">
      4.5 不要消化自己不该处理的错误
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#46" class="md-nav__link">
    <span class="md-ellipsis">
      4.6 不要为了炫技而故意降低代码可读性
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                

<!--
Hack: check whether the content contains a h1 headline. If it
doesn't, the page title (or respectively site name) is used
as the main headline.
-->

    <h1>Python 个人代码风格指导</h1>


<!-- Markdown content -->

    

        <aside class="mdx-author">
            <p>
                <img src="https://avatars.githubusercontent.com/zhanbao2000" alt="@zhanbao2000">
            </p>
            <p>
                <span>
                    <b>Akiba Arisa</b> · <a href="https://github.com/zhanbao2000">@zhanbao2000</a>
                </span>
                <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-clock" viewBox="0 0 16 16">
                        <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                        <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
                    </svg> 45 min read
                </span>
            </p>
        </aside>

    

    
        <div class="tags">
        
            <a href="/tags/#python" class="tag"><code>#python</code></a>
        
        </div>
    

    <div class="admonition abstract">
<p class="admonition-title">摘要</p>
<p>这是一篇简要的 Python 代码风格指导，代表了我个人所倾向的代码风格。使用这些风格可以让你的代码看起来更 Pythonic，更精炼地描述你代码所作的工作，或许也可以减轻你的重构压力。</p>
<p>每个人的风格可能大同小异，也有可能大相径庭，写在这里并不代表我的就是最好的。我所希望的是，读者阅读完此篇文章后能够有所启发，或是发现自己从未使用过的优雅方法，或是改善自己从未意识到的丑陋写法，如此一来我就已经很满足了。</p>
<p>这里面的很多示例代码（包括坏代码）来源于我修改自己的代码而得出的经验与风格，我也正是在修改并美化这些代码的过程中产生了写这么一篇文章的想法。</p>
</div>
<h2 id="_1">一、绪论<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<h3 id="11-python-import-this">1.1 Python 之禅：<code class="highlight"><span class="kn">import</span><span class="w"> </span><span class="nn">this</span></code><a class="headerlink" href="#11-python-import-this" title="Permanent link">&para;</a></h3>
<p>Python之禅最早由 Tim Peters 在 Python <a href="https://mail.python.org/pipermail/python-list/1999-June/001951.html">邮件列表</a> 中发表，它包含了影响 Python 编程语言设计的19条软件编写原则。</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">this</span>
</code></pre></div>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">英文版 🇬🇧</label><label for="__tabbed_1_2">中文版 🇨🇳</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code>Beautiful is better than ugly.
Explicit is better than implicit.
Simple is better than complex.
Complex is better than complicated.
Flat is better than nested.
Sparse is better than dense.
Readability counts.
Special cases aren&#39;t special enough to break the rules.
Although practicality beats purity.
Errors should never pass silently.
Unless explicitly silenced.
In the face of ambiguity, refuse the temptation to guess.
There should be one-- and preferably only one --obvious way to do it.
Although that way may not be obvious at first unless you&#39;re Dutch.
Now is better than never.
Although never is often better than *right* now.
If the implementation is hard to explain, it&#39;s a bad idea.
If the implementation is easy to explain, it may be a good idea.
Namespaces are one honking great idea -- let&#39;s do more of those!
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code>优美优于丑陋
明了优于隐晦
简单优于复杂
复杂优于繁杂
扁平优于嵌套
稀疏优于稠密
可读性很重要
特例亦不可违背原则
即使实用比纯粹更优
错误绝不能悄悄忽略
除非它明确需要如此
面对不确定性，拒绝妄加猜测
任何问题应有一种，且最好只有一种，显而易见的解决方法
尽管这方法一开始并非如此直观（除非你是荷兰人）
做优于不做
然而不假思索还不如不做
很难解释的，必然是坏方法
很好解释的，可能是好方法
命名空间是个绝妙的主意，我们应好好利用它
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<h3 id="12-pep-8">1.2 PEP-8<a class="headerlink" href="#12-pep-8" title="Permanent link">&para;</a></h3>
<p><a href="https://www.python.org/dev/peps/pep-0008/">PEP-8</a> 全称 <code>PEP 8 – Style Guide for Python Code</code>，它给出了构成 Python 主发行版中标准库的 Python 代码的编码规范。</p>
<p>遵守 PEP-8 是一个很好的习惯，它并不是一个必要的规范。PEP-8 可以让你的代码看起来更规范，更简洁，更易读。尤其是统一的格式，更容易被人阅读。</p>
<p>一些 IDE（例如 PyCharm）可以自动标记你代码中不遵守 PEP-8 的情况。除此以外，你也可以通过以下方式来检查你的代码是否遵守了 PEP-8 规范：</p>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>pep8<span class="w"> </span>--statistics<span class="w"> </span>my_file.py
</code></pre></div>
<p><del>习惯性遵守 PEP-8 可能会让您变成 PEP-8 的受害者，导致您使用其他语言时仍然保留了 PEP-8 中的习惯，尽管这些语言中并没有类似的要求。</del></p>
<p>但请注意，PEP-8 并不是教条，它不是一个你必须遵守的语法规则。正如 <a href="https://www.python.org/dev/peps/pep-0008/">PEP-8</a> 中所述：</p>
<div class="admonition cite">
<p class="admonition-title">引用</p>
<p>However, know when to be inconsistent – sometimes style guide recommendations just aren’t applicable. When in doubt, use your best judgment. Look at other examples and decide what looks best.</p>
<p>然而有时 PEP-8 确实不适用，因此你得知道在什么情况下可以与 PEP-8 不一致。每当有疑问时，请相信自己的最佳判断，或者看看其他的例子来决定哪一个看起来最好。</p>
</div>
<p>那么问题来了，什么情况下不适用呢？</p>
<div class="admonition example">
<p class="admonition-title">PEP-8 不适用的情形</p>
<ul>
<li>应用 PEP-8 会降低代码的可读性（例如长的 URL 可以无需换行）</li>
<li>为了使上下代码风格一致而不得不违背 PEP-8（尽管这也是一个清理别人的烂摊子的机会）</li>
<li>代码写于 PEP-8 引入之前，并且确实没有修改该代码的必要（注：PEP-8 发布于 2001 年，它可能比你的年龄还大）</li>
<li>代码需要与旧版本的 Python 保持兼容，但旧版本的 Python 不支持 PEP-8 中的某些做法（真没见过）</li>
</ul>
</div>
<h2 id="_2">二、该使用什么<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<h3 id="21">2.1 使用合适的对象作为数据结构<a class="headerlink" href="#21" title="Permanent link">&para;</a></h3>
<p>Python 中有多种对象——列表、字典、集合、元组和字符串，以下是对比：</p>
<table>
<thead>
<tr>
<th></th>
<th style="text-align: center;">元素可重复</th>
<th style="text-align: center;">元素可追加</th>
<th style="text-align: center;">对象可哈希</th>
<th style="text-align: center;">元素可索引</th>
</tr>
</thead>
<tbody>
<tr>
<td>列表</td>
<td style="text-align: center;">🟢</td>
<td style="text-align: center;">🟢</td>
<td style="text-align: center;">🔴</td>
<td style="text-align: center;">🟢</td>
</tr>
<tr>
<td>字典</td>
<td style="text-align: center;">🔴</td>
<td style="text-align: center;">🟢</td>
<td style="text-align: center;">🔴</td>
<td style="text-align: center;">🔴</td>
</tr>
<tr>
<td>集合</td>
<td style="text-align: center;">🔴</td>
<td style="text-align: center;">🟢</td>
<td style="text-align: center;">🔴</td>
<td style="text-align: center;">🔴</td>
</tr>
<tr>
<td>元组</td>
<td style="text-align: center;">🟢</td>
<td style="text-align: center;">🔴</td>
<td style="text-align: center;">🟢</td>
<td style="text-align: center;">🟢</td>
</tr>
<tr>
<td>字符串</td>
<td style="text-align: center;">🟢</td>
<td style="text-align: center;">🔴</td>
<td style="text-align: center;">🟢</td>
<td style="text-align: center;">🟢</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">注：</p>
<ol>
<li>字典的不可重复指的是，字典中的键不能重复。</li>
<li>是否可追加的标准是，首先这个对象可以追加新元素，其次在追加前后，使用 <code class="highlight"><span class="nb">id</span><span class="p">()</span></code> 函数计算出的指针是否一致（即是否仍为同一个对象）。</li>
<li>可以使用 <code class="highlight"><span class="nb">hash</span><span class="p">()</span></code> 函数或是 <code class="highlight"><span class="fm">__hash__</span><span class="p">()</span></code> 魔法方法的对象视为可哈希。</li>
<li>由于所有的可迭代对象（上面5个都是）都可以使用 <code class="highlight"><span class="nb">sorted</span><span class="p">()</span></code> 函数进行排序，采用这个标准来进行比较是没有意义的，所以不采用元素是否有序作为这5个对象的对比项目。</li>
<li>元素可索引指的是对象中的元素是否可以按顺序索引（或者说是否具有类似线性表一样的存储结构），而不是指该对象是否具有 <code class="highlight"><span class="fm">__setitem__</span><span class="p">()</span></code> 魔法方法。</li>
</ol>
</div>
<p>除字符串外，其余4个通常用于表示一组数据（或映射，例如字典）。以下是我总结的<strong>在什么时候使用什么样的数据结构</strong>：</p>
<dl>
<dt>列表（<code class="highlight"><span class="nb">list</span></code>）-&gt; <strong>绝大多数情况下的最佳选择</strong></dt>
<dd>你的数据是按顺序索引的，并且需要频繁地修改、追加、删除。（换句能听懂的人话：<strong>链表</strong>）</dd>
<dt>字典（<code class="highlight"><span class="nb">dict</span></code>）</dt>
<dd>你需要使用一个类似哈希表（散列表）的数据结构。</dd>
<dt>集合（<code class="highlight"><span class="nb">set</span></code>）</dt>
<dd>你的数据需要频繁地追加、删除，并且你确信你可能会追加相同的数据，而这是你想要避免的（<code class="highlight"><span class="nb">set</span></code> 会自动忽略追加的重复元素）。</dd>
<dt>元组（<code class="highlight"><span class="nb">tuple</span></code>）</dt>
<dd>你的数据只需要定义一次，并且从不修改、追加、删除。或者当你的数据总是组队出现时（例如坐标、TCP 四元组）。</dd>
</dl>
<p><del>可能此时某些人看完会钻牛角尖，非得搁这纠结什么链表和数组性能差异和实现上的不同，我已经说得很清楚了，和线性表这类东西作比较<strong>仅仅是为了打比方</strong>。你要这么纠结你就去用 <code>np.ndarray</code>，或者干脆别用 Python 了，直接去用你心爱的 C/C++，而不用在这纠结 Python 的几个对象。</del></p>
<h3 id="22">2.2 积极使用类型注释<a class="headerlink" href="#22" title="Permanent link">&para;</a></h3>
<p>使用类型注释可以让你的 IDE 和其他开发者更好地阅读你的代码，并且在后期的重构时，能更大胆地进行代码复用，而无须纠结参数的类型。</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Good:
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</code></pre></div></p>
<p>Bad:
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</code></pre></div></p>
</div>
<p>可以使用 <code>typing</code> 标准库来编写更高级的类型注释，例如：</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Union</span>

<span class="n">RealNumeric</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;RealNumeric&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_complex</span><span class="p">(</span><span class="n">re</span><span class="p">:</span> <span class="n">RealNumeric</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">im</span><span class="p">:</span> <span class="n">RealNumeric</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">RealNumeric</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]:</span>
    <span class="k">return</span> <span class="n">re</span> <span class="o">+</span> <span class="n">im</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span>
</code></pre></div>
</div>
<p>甚至使用泛型：</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypeVar</span>

<span class="n">_T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;_T&#39;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">if_pattern</span><span class="p">(</span><span class="n">pattern</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">_T</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pattern</span><span class="p">)</span><span class="o">.</span><span class="fm">__next__</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div>
</div>
<h3 id="23">2.3 函数的功能应具有专一性<a class="headerlink" href="#23" title="Permanent link">&para;</a></h3>
<p>应避免同一个函数有多个功能（或返回值），例如：</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Ugly:
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calc</span><span class="p">(</span><span class="n">const</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">rating</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">const</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="o">...</span>  <span class="c1"># calc the const</span>
    <span class="k">if</span> <span class="n">rating</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="o">...</span>  <span class="c1"># calc the rating</span>
    <span class="k">if</span> <span class="n">score</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="o">...</span>  <span class="c1"># calc the score</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid input!&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></p>
</div>
<p>请注意，这是我曾经用于计算某个🇬🇧游戏的一些数值时采用的函数写法，现在我觉得它奇丑无比。</p>
<h2 id="_3">三、该取代什么<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="31">3.1 使用<strong>优美</strong>的现有方法取代<strong>丑陋</strong>的自行实现<a class="headerlink" href="#31" title="Permanent link">&para;</a></h3>
<p>以判断字典中是否有某个键的方法为例：</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Good:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="s1">&#39;some_key&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
    <span class="o">...</span>
</code></pre></div>
<p>Bad:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="s1">&#39;some_key&#39;</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;some_key&#39;</span><span class="p">):</span>
    <span class="o">...</span>
</code></pre></div>
</div>
<p>并且请注意：事实上，<code class="highlight"><span class="nb">dict</span></code> 类的 <code class="highlight"><span class="n">has_key</span><span class="p">()</span></code> 方法已经 <a href="https://docs.python.org/3.1/whatsnew/3.0.html#builtins">在 Python3 中被移除</a>，所以大部分情况下你也用不着它（或者没法用它）。</p>
<p>还有一个例子，这适用于 Bot 解析某些视频 URL 时用于缩短视频描述（或简介）的文字。</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Good:</p>
<div class="highlight"><pre><span></span><code><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;描述：</span><span class="si">{</span><span class="n">textwrap</span><span class="o">.</span><span class="n">shorten</span><span class="p">(</span><span class="n">video</span><span class="o">.</span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span><span class="w"> </span><span class="n">placeholder</span><span class="o">=</span><span class="s2">&quot; ...&quot;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
</code></pre></div>
<p>Bad:</p>
<div class="highlight"><pre><span></span><code><span class="n">dotx3_description</span> <span class="o">=</span> <span class="s1">&#39;...&#39;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">video</span><span class="o">.</span><span class="n">description</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">60</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
<span class="o">...</span>
<span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;描述：</span><span class="si">{</span><span class="n">video</span><span class="o">.</span><span class="n">description</span><span class="p">[:</span><span class="mi">60</span><span class="p">]</span><span class="si">}{</span><span class="n">dotx3_description</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
</code></pre></div>
</div>
<p>由于 Python 自身的性质，使用 Python 实现一个特定的功能非常容易，但也正因为如此，有不少初学者在学习前期会使用大量的自行实现，这种自行实现又常常被称为 <code>重复发明轮子</code>。</p>
<p>重复发明轮子并不一无是处，对于初学者而言，这常常是一种提升自身基本能力的有效手段。然而对于并非初学者的我们，重复发明轮子已经不再有任何用途了，因此需要极力避免这种情况发生。</p>
<p>一般来说，选择具体的实现方法时，考虑以下优先顺序：</p>
<ul>
<li>语句、<a href="https://docs.python.org/zh-cn/3/library/functions.html"><code>Builtins</code> 函数</a></li>
<li><a href="https://rszalski.github.io/magicmethods/">魔法方法</a>、方法</li>
<li><a href="https://docs.python.org/zh-cn/3/library/index.html">Python 标准库</a></li>
<li>第三方库</li>
<li>自行实现</li>
</ul>
<p>在多种实现的复杂度相差无几时，上面排序越靠前的实现方法看起来越优雅，而越往后的实现方法看起来越丑陋。只有在你发现靠前的方法无法满足你的需求（或过于复杂）时，才有必要考虑靠后的方法。</p>
<h3 id="32">3.2 使用括号换行取代换行符换行<a class="headerlink" href="#32" title="Permanent link">&para;</a></h3>
<p>Python 中的括号有个 <a href="https://docs.python.org/2/reference/lexical_analysis.html#implicit-line-joining">特性</a>，就是括号中的表达式可以在一个行上直接分割，而无须使用 <code>\</code> 换行。</p>
<p>以 <code class="highlight"><span class="kn">import</span></code> 语句为例：</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Good:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">.make_score_image</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">moe_draw_recent</span><span class="p">,</span> <span class="n">guin_draw_recent</span><span class="p">,</span> <span class="n">bandori_draw_recent</span><span class="p">,</span>
    <span class="n">andreal_v1_draw_recent</span><span class="p">,</span> <span class="n">andreal_v2_draw_recent</span><span class="p">,</span> <span class="n">andreal_v3_draw_recent</span><span class="p">,</span> <span class="n">andreal_draw_b30</span><span class="p">,</span>
    <span class="n">song_list</span><span class="p">,</span> <span class="n">draw_b30</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<p>Bad:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">.make_score_image</span><span class="w"> </span><span class="kn">import</span> <span class="n">moe_draw_recent</span><span class="p">,</span> <span class="n">guin_draw_recent</span><span class="p">,</span> <span class="n">bandori_draw_recent</span><span class="p">,</span> <span class="n">song_list</span><span class="p">,</span> <span class="n">draw_b30</span><span class="p">,</span> \
    <span class="n">andreal_v1_draw_recent</span><span class="p">,</span> <span class="n">andreal_v2_draw_recent</span><span class="p">,</span> <span class="n">andreal_v3_draw_recent</span><span class="p">,</span> <span class="n">andreal_draw_b30</span>
</code></pre></div>
</div>
<p>值得注意的是，在括号内进行换行后，请注意缩进。要么使用垂直缩进，要么使用悬挂缩进。</p>
<p>以 <code class="highlight"><span class="k">if</span></code> 语句为例：</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Good:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 4空格悬挂缩进</span>
<span class="k">if</span> <span class="p">(</span>
    <span class="n">this_vid</span> <span class="o">!=</span> <span class="n">last_vid</span>
    <span class="ow">or</span> <span class="n">this_vid</span> <span class="o">==</span> <span class="n">last_vid</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="n">this_lang</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zh-Hans&#39;</span><span class="p">,</span> <span class="s1">&#39;zh&#39;</span><span class="p">]</span>
        <span class="ow">or</span> <span class="n">this_lang</span> <span class="o">==</span> <span class="s1">&#39;ja&#39;</span> <span class="ow">and</span> <span class="n">last_lang</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zh-Hans&#39;</span><span class="p">,</span> <span class="s1">&#39;zh&#39;</span><span class="p">]</span>
        <span class="ow">or</span> <span class="n">this_lang</span> <span class="o">==</span> <span class="s1">&#39;en&#39;</span> <span class="ow">and</span> <span class="n">last_lang</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zh-Hans&#39;</span><span class="p">,</span> <span class="s1">&#39;zh&#39;</span><span class="p">,</span> <span class="s1">&#39;ja&#39;</span><span class="p">]</span>
    <span class="p">)</span>
<span class="p">):</span>
    <span class="o">...</span>

<span class="c1"># 使用垂直缩进</span>
<span class="k">if</span> <span class="p">(</span><span class="n">this_vid</span> <span class="o">!=</span> <span class="n">last_vid</span>
    <span class="ow">or</span> <span class="n">this_vid</span> <span class="o">==</span> <span class="n">last_vid</span> <span class="ow">and</span> <span class="p">(</span><span class="n">this_lang</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zh-Hans&#39;</span><span class="p">,</span> <span class="s1">&#39;zh&#39;</span><span class="p">]</span>
                                 <span class="ow">or</span> <span class="n">this_lang</span> <span class="o">==</span> <span class="s1">&#39;ja&#39;</span> <span class="ow">and</span> <span class="n">last_lang</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zh-Hans&#39;</span><span class="p">,</span> <span class="s1">&#39;zh&#39;</span><span class="p">]</span>
                                 <span class="ow">or</span> <span class="n">this_lang</span> <span class="o">==</span> <span class="s1">&#39;en&#39;</span> <span class="ow">and</span> <span class="n">last_lang</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zh-Hans&#39;</span><span class="p">,</span> <span class="s1">&#39;zh&#39;</span><span class="p">,</span> <span class="s1">&#39;ja&#39;</span><span class="p">])):</span>
    <span class="o">...</span>
</code></pre></div>
<p>Bad:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 无任何缩进</span>
<span class="k">if</span> <span class="n">this_vid</span> <span class="o">!=</span> <span class="n">last_vid</span> <span class="ow">or</span> <span class="n">this_vid</span> <span class="o">==</span> <span class="n">last_vid</span> <span class="ow">and</span> <span class="p">(</span><span class="n">this_lang</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zh-Hans&#39;</span><span class="p">,</span> <span class="s1">&#39;zh&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">this_lang</span> <span class="o">==</span> <span class="s1">&#39;ja&#39;</span> <span class="ow">and</span> <span class="n">last_lang</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zh-Hans&#39;</span><span class="p">,</span> <span class="s1">&#39;zh&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">this_lang</span> <span class="o">==</span> <span class="s1">&#39;en&#39;</span> <span class="ow">and</span> <span class="n">last_lang</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zh-Hans&#39;</span><span class="p">,</span> <span class="s1">&#39;zh&#39;</span><span class="p">,</span> <span class="s1">&#39;ja&#39;</span><span class="p">]):</span>
    <span class="o">...</span>

<span class="c1"># 使用丑陋的 \ 进行换行</span>
<span class="k">if</span> <span class="n">this_vid</span> <span class="o">!=</span> <span class="n">last_vid</span> <span class="ow">or</span> <span class="n">this_vid</span> <span class="o">==</span> <span class="n">last_vid</span> \
    <span class="ow">and</span> <span class="p">(</span><span class="n">this_lang</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zh-Hans&#39;</span><span class="p">,</span> <span class="s1">&#39;zh&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">this_lang</span> <span class="o">==</span> <span class="s1">&#39;ja&#39;</span> \
         <span class="ow">and</span> <span class="n">last_lang</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zh-Hans&#39;</span><span class="p">,</span> <span class="s1">&#39;zh&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">this_lang</span> <span class="o">==</span> <span class="s1">&#39;en&#39;</span> \
         <span class="ow">and</span> <span class="n">last_lang</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zh-Hans&#39;</span><span class="p">,</span> <span class="s1">&#39;zh&#39;</span><span class="p">,</span> <span class="s1">&#39;ja&#39;</span><span class="p">]):</span>
    <span class="o">...</span>

<span class="c1"># 4空格悬挂缩进对齐到 if</span>
<span class="k">if</span> <span class="n">this_vid</span> <span class="o">!=</span> <span class="n">last_vid</span> <span class="ow">or</span> <span class="n">this_vid</span> <span class="o">==</span> <span class="n">last_vid</span> <span class="ow">and</span> <span class="p">(</span><span class="n">this_lang</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zh-Hans&#39;</span><span class="p">,</span> <span class="s1">&#39;zh&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">this_lang</span> <span class="o">==</span> <span class="s1">&#39;ja&#39;</span> <span class="ow">and</span> <span class="n">last_lang</span> 
    <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zh-Hans&#39;</span><span class="p">,</span> <span class="s1">&#39;zh&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">this_lang</span> <span class="o">==</span> <span class="s1">&#39;en&#39;</span> <span class="ow">and</span> <span class="n">last_lang</span> <span class="ow">not</span> <span class="ow">in</span> 
    <span class="p">[</span><span class="s1">&#39;zh-Hans&#39;</span><span class="p">,</span> <span class="s1">&#39;zh&#39;</span><span class="p">,</span> <span class="s1">&#39;ja&#39;</span><span class="p">]):</span>
    <span class="o">...</span>
</code></pre></div>
</div>
<p>以字符串的多行拼接为例：</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Good:</p>
<div class="highlight"><pre><span></span><code><span class="n">text</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s1">&#39;项目：</span><span class="si">{</span><span class="n">repo</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="sa">f</span><span class="s1">&#39;作者：</span><span class="si">{</span><span class="n">owner</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="sa">f</span><span class="s1">&#39;大小：</span><span class="si">{</span><span class="n">repo</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s1"> KB</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="sa">f</span><span class="s1">&#39;语言：</span><span class="si">{</span><span class="n">repo</span><span class="o">.</span><span class="n">language</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;无&quot;</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="sa">f</span><span class="s1">&#39;许可证：</span><span class="si">{</span><span class="n">license_</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="sa">f</span><span class="s1">&#39;🐞:</span><span class="si">{</span><span class="n">repo</span><span class="o">.</span><span class="n">open_issues_count</span><span class="si">}</span><span class="s1"> ⭐:</span><span class="si">{</span><span class="n">repo</span><span class="o">.</span><span class="n">stargazers_count</span><span class="si">}</span><span class="s1"> 🍴:</span><span class="si">{</span><span class="n">repo</span><span class="o">.</span><span class="n">forks_count</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="sa">f</span><span class="s1">&#39;创建时间：</span><span class="si">{</span><span class="n">format_time</span><span class="p">(</span><span class="n">repo</span><span class="o">.</span><span class="n">created_at</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="sa">f</span><span class="s1">&#39;上次提交：</span><span class="si">{</span><span class="n">format_time</span><span class="p">(</span><span class="n">repo</span><span class="o">.</span><span class="n">pushed_at</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="sa">f</span><span class="s1">&#39;描述：</span><span class="si">{</span><span class="n">repo</span><span class="o">.</span><span class="n">description</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;无&quot;</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="sa">f</span><span class="s1">&#39;标签：</span><span class="si">{</span><span class="n">tags</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="p">)</span>
</code></pre></div>
<p>Bad:</p>
<div class="highlight"><pre><span></span><code><span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;项目：</span><span class="si">{</span><span class="n">repo</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span> \
       <span class="sa">f</span><span class="s1">&#39;作者：</span><span class="si">{</span><span class="n">owner</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span> \
       <span class="sa">f</span><span class="s1">&#39;大小：</span><span class="si">{</span><span class="n">repo</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s1"> KB</span><span class="se">\n</span><span class="s1">&#39;</span> \
       <span class="sa">f</span><span class="s1">&#39;语言：</span><span class="si">{</span><span class="n">repo</span><span class="o">.</span><span class="n">language</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;无&quot;</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span> \
       <span class="sa">f</span><span class="s1">&#39;许可证：</span><span class="si">{</span><span class="n">license_</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span> \
       <span class="sa">f</span><span class="s1">&#39;🐞:</span><span class="si">{</span><span class="n">repo</span><span class="o">.</span><span class="n">open_issues_count</span><span class="si">}</span><span class="s1"> ⭐:</span><span class="si">{</span><span class="n">repo</span><span class="o">.</span><span class="n">stargazers_count</span><span class="si">}</span><span class="s1"> 🍴:</span><span class="si">{</span><span class="n">repo</span><span class="o">.</span><span class="n">forks_count</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span> \
       <span class="sa">f</span><span class="s1">&#39;创建时间：</span><span class="si">{</span><span class="n">format_time</span><span class="p">(</span><span class="n">repo</span><span class="o">.</span><span class="n">created_at</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span> \
       <span class="sa">f</span><span class="s1">&#39;上次提交：</span><span class="si">{</span><span class="n">format_time</span><span class="p">(</span><span class="n">repo</span><span class="o">.</span><span class="n">pushed_at</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span> \
       <span class="sa">f</span><span class="s1">&#39;描述：</span><span class="si">{</span><span class="n">repo</span><span class="o">.</span><span class="n">description</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;无&quot;</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span> \
       <span class="sa">f</span><span class="s1">&#39;标签：</span><span class="si">{</span><span class="n">tags</span><span class="si">}</span><span class="s1">&#39;</span>
</code></pre></div>
</div>
<p>提示：对于需要很多换行的字符串，使用 <code>"""</code> 搭配 <a href="https://docs.python.org/zh-cn/3/library/textwrap.html#textwrap.dedent"><code>textwrap.dedent()</code></a> 是<strong>最优</strong>的选择：</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>⭐<strong>Best:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">textwrap</span>

<span class="n">text</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">    项目：</span><span class="si">{</span><span class="n">repo</span><span class="o">.</span><span class="n">name</span><span class="si">}</span>
<span class="s2">    作者：</span><span class="si">{</span><span class="n">owner</span><span class="si">}</span>
<span class="s2">    大小：</span><span class="si">{</span><span class="n">repo</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2"> KB</span>
<span class="s2">    语言：</span><span class="si">{</span><span class="n">repo</span><span class="o">.</span><span class="n">language</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;无&quot;</span><span class="si">}</span>
<span class="s2">    许可证：</span><span class="si">{</span><span class="n">license_</span><span class="si">}</span>
<span class="s2">    🐞:</span><span class="si">{</span><span class="n">repo</span><span class="o">.</span><span class="n">open_issues_count</span><span class="si">}</span><span class="s2"> ⭐:</span><span class="si">{</span><span class="n">repo</span><span class="o">.</span><span class="n">stargazers_count</span><span class="si">}</span><span class="s2"> 🍴:</span><span class="si">{</span><span class="n">repo</span><span class="o">.</span><span class="n">forks_count</span><span class="si">}</span>
<span class="s2">    创建时间：</span><span class="si">{</span><span class="n">format_time</span><span class="p">(</span><span class="n">repo</span><span class="o">.</span><span class="n">created_at</span><span class="p">)</span><span class="si">}</span>
<span class="s2">    上次提交：</span><span class="si">{</span><span class="n">format_time</span><span class="p">(</span><span class="n">repo</span><span class="o">.</span><span class="n">pushed_at</span><span class="p">)</span><span class="si">}</span>
<span class="s2">    描述：</span><span class="si">{</span><span class="n">repo</span><span class="o">.</span><span class="n">description</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;无&quot;</span><span class="si">}</span>
<span class="s2">    标签：</span><span class="si">{</span><span class="n">tags</span><span class="si">}</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<p><code>textwrap</code> 是 Python 标准库之一，其中的 <a href="https://docs.python.org/zh-cn/3/library/textwrap.html#textwrap.dedent"><code>dedent()</code></a> 函数可以移除 <code>text</code> 中每一行的任何相同前缀空白符。这可以用来清除三重引号字符串行左侧空格，并在源码中仍然显示为缩进格式。</p>
<h3 id="33-python">3.3 使用 Python 习语取代某些自行实现<a class="headerlink" href="#33-python" title="Permanent link">&para;</a></h3>
<div class="admonition cite">
<p class="admonition-title">引用</p>
<p>如果询问一个 Python 开发者他最喜欢 Python 的哪一点，他们通常会说是其可读性。确实，高可读性是 Python 语言设计的核心准则之一。一个不争的事实是，相对于写代码而言，读代码才是更加平常的事情。</p>
<p>Python 代码之所以容易阅读和理解，原因之一就是它有着相对完整的编码风格指南以及各种各样 “Pythonic” 的习语。</p>
<p>当一个富有经验的 Python 开发者（也称为 Pythonista）指出一部分代码不够 “Pythonic” 的时，通常意味着这部分代码没有遵循通用的风格指南，同时也没有按照最佳方式（即：最具有可读性）来表达出代码的意图。</p>
<p>—— <a href="https://github.com/realpython/python-guide">realpython/python-guide</a></p>
</div>
<ol>
<li>
<p>解包</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Normal:</p>
<div class="highlight"><pre><span></span><code><span class="n">sentence</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;The&#39;</span><span class="p">,</span> <span class="s1">&#39;fox&#39;</span><span class="p">,</span> <span class="s1">&#39;jumped&#39;</span><span class="p">,</span> <span class="s1">&#39;over&#39;</span><span class="p">,</span> <span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;fence&#39;</span><span class="p">)</span>
<span class="n">word_1</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">word_2</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">word_3</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">word_4</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">word_5</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</code></pre></div>
<p>Pythonic:</p>
<div class="highlight"><pre><span></span><code><span class="n">sentence</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;The&#39;</span><span class="p">,</span> <span class="s1">&#39;fox&#39;</span><span class="p">,</span> <span class="s1">&#39;jumped&#39;</span><span class="p">,</span> <span class="s1">&#39;over&#39;</span><span class="p">,</span> <span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;fence&#39;</span><span class="p">)</span>
<span class="n">word_1</span><span class="p">,</span> <span class="n">word_2</span><span class="p">,</span> <span class="n">word_3</span><span class="p">,</span> <span class="n">word_4</span><span class="p">,</span> <span class="n">word_5</span> <span class="o">=</span> <span class="n">sentence</span>
</code></pre></div>
</div>
</li>
<li>
<p>交换变量（交换变量本质上也是一种解包）</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Normal:</p>
<div class="highlight"><pre><span></span><code><span class="n">c</span> <span class="o">=</span> <span class="n">a</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">b</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">c</span>
</code></pre></div>
<p>Pythonic:</p>
<div class="highlight"><pre><span></span><code><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span>
</code></pre></div>
</div>
</li>
<li>
<p>列表推导式</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Normal:</p>
<div class="highlight"><pre><span></span><code><span class="n">squares</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">squares</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div>
<p>Pythonic:</p>
<div class="highlight"><pre><span></span><code><span class="n">squares</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</code></pre></div>
</div>
<p>注意，若写成 <code class="highlight"><span class="n">squares</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span></code>，那么这是一个迭代器，只有当 <code>squares</code> 被消费时，才会真正执行里面的 <code class="highlight"><span class="nb">range</span><span class="p">()</span></code> 函数。</p>
</li>
<li>
<p>带索引的循环</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Normal:</p>
<div class="highlight"><pre><span></span><code><span class="n">bag</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;banana&#39;</span><span class="p">,</span> <span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;pear&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;grape&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bag</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">bag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<p>Pythonic:</p>
<div class="highlight"><pre><span></span><code><span class="n">bag</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;banana&#39;</span><span class="p">,</span> <span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;pear&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;grape&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bag</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
</div>
</li>
<li>
<p>简化链式判断规则</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Normal:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="mi">20</span><span class="p">:</span>
    <span class="o">...</span>
</code></pre></div>
<p>Pythonic:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="mi">10</span> <span class="o">&lt;=</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="mi">20</span><span class="p">:</span>
    <span class="o">...</span>
</code></pre></div>
</div>
</li>
<li>
<p>类型判断</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Normal:</p>
<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">Y</span><span class="p">()</span>
<span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">Y</span>
</code></pre></div>
<p>Pythonic:</p>
<div class="highlight"><pre><span></span><code><span class="n">x</span> <span class="o">=</span> <span class="n">Y</span><span class="p">()</span>
<span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
</code></pre></div>
</div>
</li>
<li>
<p>使用上下文管理器进行文件读写</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Normal:</p>
<div class="highlight"><pre><span></span><code><span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
<p>Pythonic:</p>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="o">...</span>
</code></pre></div>
</div>
<p>使用传统的 <code class="highlight"><span class="nb">open</span><span class="p">()</span></code> 函数打开文件，需要在结束读写之后手动使用 <code class="highlight"><span class="n">close</span><span class="p">()</span></code> 方法关闭文件句柄。若读写结束之后没有关闭文件句柄，将<strong>可能</strong>导致文件句柄被占用，从而导致程序异常退出（例如报 <code>WindowsError: [Error 32]</code>）。</p>
<p>即使意识到了这一点，在每一次读写操作结束后，都添加一句 <code class="highlight"><span class="n">close</span><span class="p">()</span></code> 来关闭文件句柄，这样也是不可靠的。因为可能在文件处理过程中发生某些其他的错误，在错误处理过程中跳过了 <code class="highlight"><span class="n">close</span><span class="p">()</span></code> 方法，这样也会导致文件句柄未关闭。</p>
<p>使用 <code class="highlight"><span class="k">with</span></code> 语句的好处在于：</p>
<ul>
<li>可以自动关闭文件句柄，不需要在结束读写之后手动关闭文件句柄。</li>
<li>即使在文件处理过程中发生其他的错误，也能保证文件句柄被正确关闭。</li>
</ul>
</li>
<li>
<p>使用<a href="https://docs.python.org/zh-cn/3/whatsnew/3.8.html#assignment-expressions">海象运算符</a>（<code>:=</code>）在任何表达式内部为变量赋值</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Normal:</p>
<div class="highlight"><pre><span></span><code><span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;https://example.com/?name=</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</code></pre></div>
<p>Pythonic:</p>
<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="n">url</span> <span class="o">:=</span> <span class="sa">f</span><span class="s1">&#39;https://example.com/?name=</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Normal:</p>
<div class="highlight"><pre><span></span><code><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;太长了&#39;</span><span class="p">)</span>
</code></pre></div>
<p>Pythonic:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="n">n</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;太长了&#39;</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Normal:</p>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;test.png&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">block</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">process</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
</code></pre></div>
<p>Pythonic:</p>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;test.png&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">while</span> <span class="n">block</span> <span class="o">:=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
    <span class="n">process</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>若在列表推导式中，需要在筛选条件中计算一个值，而同一个值又在表达式中需要被使用：</p>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="p">(</span><span class="n">y</span> <span class="o">:=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</code></pre></div>
<p>注意此处若不使用海象运算符，则无法使用列表推导式实现，只能通过 <code class="highlight"><span class="k">for</span></code> 循环实现。</p>
</div>
<p>请尽量将海象运算符的使用限制在清晰的场合中，以降低复杂性并提升可读性。</p>
</li>
</ol>
<h2 id="_4">四、该避免什么<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<h3 id="41">4.1 避免迷惑命名<a class="headerlink" href="#41" title="Permanent link">&para;</a></h3>
<div class="admonition cite">
<p class="admonition-title">引用</p>
<p>改名不仅仅是修改名字而已。如果你想不出一个好名字，说明背后很可能潜藏着更深的设计问题。为一个恼人的名字所付出的纠结，常常能推动我们对代码进行精简。</p>
<p>—— 《重构：改善既有代码的设计》</p>
</div>
<p>命名是程序员最难解决的一个问题之一，而迷惑命名将导致后期重构时无法正确理解对象的含义。</p>
<p>虽然我们无法做到 100% 的完美命名，使每个对象的名字都恰到好处，但是我们可以避免出现迷惑命名。一个不佳的命名可能仅仅会给阅读代码带来困难，而迷惑命名则会使我们完全混淆代码的含义。以下列举了一些迷惑命名的例子：</p>
<ol>
<li>
<p>混淆使用元素列表命名</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">user_list</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</code></pre></div>
</div>
<p><code>user_list</code> 和 <code>users</code> 都可以表示一个存储用户信息的列表。假如一个过程内同时定义了 <code>user_list</code> 和 <code>users</code>，你会怎样去区分呢？最好的方法是只使用其中的一种命名方式，而我选择的是前者（后者当然也行，但请不要混淆使用！）</p>
</li>
<li>
<p>混淆使用下划线</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="n">song_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Song</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">songlist</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div>
</div>
<p>以上写法非常令人迷惑，<code>song_list</code> 和 <code>songlist</code> 可能都是表示某个🇬🇧游戏的歌曲列表，但是表示这个 “列表” 的数据结构却是不同的。在同一个过程内部同时使用这两个变量将会使其他开发者（甚至自己！）在调用它们时罔知所措。</p>
<p>得亏这是有 typing hint 的情况，要是遇到一些没有标注 typing hint 还这样写的代码（<del>例如我的早期代码</del>），那就真的让人背地里想骂人了。</p>
</li>
<li>
<p>变量名加入累赘的前/后缀</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="n">user</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">user_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">user_info</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">user_detail</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">user_metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">user_information</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div>
</div>
<p>这种命名何止是迷惑，简直是令人恼火！假如一个过程内同时定义了 <code>user</code>、<code>user_data</code>、<code>user_info</code>、<code>user_detail</code>、<code>user_metadata</code> 和 <code>user_information</code>，如果我要获取用户的信息，请问我该调用那个变量呢？</p>
<p>建议在新的变量命名之前，仔细检查已经命名过的变量，如果出现这种多个不同后缀表示同一数据的情况，则可能说明<strong>这已经不是简单的命名问题了</strong>。</p>
</li>
<li>
<p>不恰当的缩写</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Good:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_classifier_K_nearest_neighbors</span><span class="p">(</span><span class="n">dataset</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Classifier</span><span class="p">:</span>
    <span class="o">...</span>
</code></pre></div>
<p>Bad:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_classifier_KNN</span><span class="p">(</span><span class="n">dataset</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Classifier</span><span class="p">:</span>
    <span class="o">...</span>
</code></pre></div>
</div>
<p><code>KNN</code> 指的是 <code>K-近邻算法</code>，是一种用于分类和回归的非参数统计方法，借由计算与已知类别案例之相似度，来评估未知类别案例可能的分类。</p>
<p>使用缩写的方式，可能会使代码更加简洁，但是也会使代码更加难以理解，尤其是以上这种只有在专业领域才会用到的缩写。</p>
</li>
<li>
<p>混淆使用自定义异常的后缀</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PotentialHiddenError</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PotentialHiddenException</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
    <span class="o">...</span>
</code></pre></div>
</div>
<p>假设一个月前你在 <code>exceptions.py</code> 里定义了这两个异常，一个月之后你项目的其他贡献者写代码的时候需要抛出一个 “用户潜力值被隐藏” 的异常，请问该抛出谁？这种迷惑（混淆）情形和先前提到的简直是殊途同归。</p>
<p>此外，需要注意的是，在 Python 中，更常用的异常的后缀是 <code>Error</code>，而不是 <code>Exception</code>。（见官方文档中的 <a href="https://docs.python.org/zh-cn/3/tutorial/errors.html#user-defined-exceptions">用户自定义异常</a>）</p>
</li>
</ol>
<p>命名的具体写法并不是该节的讨论重点，驼峰命名法、下划线命名法和匈牙利命名法的具体内容也已人尽皆知，这里便不再赘述。</p>
<p>具体可以参照 Python 之父 Guido 推荐的规范：</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Public</th>
<th style="text-align: left;">Internal</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Modules</td>
<td style="text-align: left;"><code>lower_with_under</code></td>
<td style="text-align: left;"><code>_lower_with_under</code></td>
</tr>
<tr>
<td style="text-align: left;">Packages</td>
<td style="text-align: left;"><code>lower_with_under</code></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">Classes</td>
<td style="text-align: left;"><code>CapWords</code></td>
<td style="text-align: left;"><code>_CapWords</code></td>
</tr>
<tr>
<td style="text-align: left;">Exceptions</td>
<td style="text-align: left;"><code>CapWords</code></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">Functions</td>
<td style="text-align: left;"><code>lower_with_under()</code></td>
<td style="text-align: left;"><code>_lower_with_under()</code></td>
</tr>
<tr>
<td style="text-align: left;">Global/Class Constants</td>
<td style="text-align: left;"><code>CAPS_WITH_UNDER</code></td>
<td style="text-align: left;"><code>_CAPS_WITH_UNDER</code></td>
</tr>
<tr>
<td style="text-align: left;">Global/Class Variables</td>
<td style="text-align: left;"><code>lower_with_under</code></td>
<td style="text-align: left;"><code>_lower_with_under</code></td>
</tr>
<tr>
<td style="text-align: left;">Instance Variables</td>
<td style="text-align: left;"><code>lower_with_under</code></td>
<td style="text-align: left;"><code>_lower_with_under</code> (protected) <br/> <code>__lower_with_under</code> (private)</td>
</tr>
<tr>
<td style="text-align: left;">Method Names</td>
<td style="text-align: left;"><code>lower_with_under()</code></td>
<td style="text-align: left;"><code>_lower_with_under()</code> (protected) <br/> <code>__lower_with_under()</code> (private)</td>
</tr>
<tr>
<td style="text-align: left;">Function/Method Parameters</td>
<td style="text-align: left;"><code>lower_with_under</code></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">Local Variables</td>
<td style="text-align: left;"><code>lower_with_under</code></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<p>和 PEP-8 一样，某些 IDE（例如 PyCharm）或者插件（例如 SonarLint）也可以自动标记你代码中不遵守上述命名法的情况。</p>
<h3 id="42">4.2 避免过长的函数<a class="headerlink" href="#42" title="Permanent link">&para;</a></h3>
<p>如果你发现一个函数的长度超过了 40 行，那么大概率说明这个函数需要精简。</p>
<p>不对函数长度做硬性限制，但是若一个函数超过来 40 行，推荐考虑一下是否可以在不损害程序结构的情况下对其进行分解。</p>
<p>因为即使现在长函数运行良好，但几个月后可能会有人修改它并添加一些新的行为，这容易产生难以发现的 bug。保持函数的简练，使其更加容易阅读和修改。</p>
<p>当遇到一些很长的函数时，若发现调试比较困难或是想在其他地方使用函数的一部分功能，不妨考虑将这个长函数进行拆分。</p>
<h3 id="43">4.3 避免在多个函数里构造一样的代码<a class="headerlink" href="#43" title="Permanent link">&para;</a></h3>
<p>解决这个问题的核心就是 <a href="https://www.runoob.com/w3cnote/python-func-decorators.html">装饰器</a>。</p>
<p>例如，我们需要在每个函数内都输出日志：</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">buy</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">quantity</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Try to buy </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s1">(s)&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_inner_buy</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">quantity</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Action failed, reason: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">asctime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">sell</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">quantity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">operator</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Try to sell </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s1">(s)&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_inner_sell</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">operator</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Action failed, reason: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">asctime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())))</span>
</code></pre></div>
<p>可见，我们每写一个函数，都需要重复实现那几个日志输出。为此，我们可以写一个装饰器，将重复操作提炼出来：</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">logger</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">item</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">args</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Try to </span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s1">(s)&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Action failed, reason: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">asctime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())))</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div>
<p>这样，我们的 <code>buy</code> 和 <code>sell</code> 函数便可以写成</p>
<div class="highlight"><pre><span></span><code><span class="nd">@logger</span>
<span class="k">def</span><span class="w"> </span><span class="nf">buy</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">quantity</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">_inner_buy</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">quantity</span><span class="p">)</span>

<span class="nd">@logger</span>
<span class="k">def</span><span class="w"> </span><span class="nf">sell</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">quantity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">operator</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">_inner_sell</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">operator</span><span class="p">)</span>
</code></pre></div>
<h3 id="44-try-except">4.4 避免滥用 <code class="highlight"><span class="k">try</span> <span class="k">except</span></code> 语句<a class="headerlink" href="#44-try-except" title="Permanent link">&para;</a></h3>
<p>不要懒惰到让 <code class="highlight"><span class="k">try</span> <span class="k">except</span></code> 语句来帮你找到错误！</p>
<p><code class="highlight"><span class="k">try</span> <span class="k">except</span></code> 语句通常是用于处理错误和异常的，但这不意味着所有的错误和异常都必须经过它的手处理。如果是一些显而易见的错误，则应当避免使用 <code class="highlight"><span class="k">try</span> <span class="k">except</span></code> 语句，而是直接消化这个可能引发的异常。</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Good:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_player_name</span><span class="p">(</span><span class="n">play_record</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">play_record</span> <span class="ow">and</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">play_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">play_record</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;Unknown&#39;</span>
</code></pre></div>
<p>Bad:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_player_name</span><span class="p">(</span><span class="n">play_record</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">play_record</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Unknown&#39;</span>
</code></pre></div>
</div>
<p>此举是为了明确错误的原因。以上面为例，在对一个 <code class="highlight"><span class="nb">list</span></code> 或 <code class="highlight"><span class="nb">dict</span></code> 反复使用 <code class="highlight"><span class="fm">__getitem__</span></code> 时（例如有些构造复杂的 json 可能会嵌套好几层），可能会导致 <code class="highlight"><span class="ne">KeyError</span></code> 和 <code class="highlight"><span class="ne">IndexError</span></code> 的错误。但是简单地接住错误并不能知道具体是哪个地方调用 <code class="highlight"><span class="fm">__getitem__</span></code> 方法时出错了，是一种晦涩的处理方法。</p>
<h3 id="45">4.5 不要消化自己不该处理的错误<a class="headerlink" href="#45" title="Permanent link">&para;</a></h3>
<p>什么是自己不该处理的错误？</p>
<p>举个例子，你需要创建一个函数，它读取一个 json 文件，并将其转换为一个 <code class="highlight"><span class="nb">dict</span></code> 对象。</p>
<p>那么问题来了：</p>
<ul>
<li>如果文件不存在，函数怎么办？</li>
<li>如果文件内容不是一个 json 字符串，函数怎么办？</li>
</ul>
<p>一些开发者可能会让该函数遇到错误时返回一个空字典，或者返回 <code class="highlight"><span class="kc">None</span></code> 对象。我个人是很不赞同这个做法的。</p>
<p>第一个问题显然不是它需要关心的事情，因此如果遇到文件不存在的情况，它原则上应该照常向上抛出 <code class="highlight"><span class="ne">FileNotFoundError</span></code> <strong>内置</strong>异常，而不是私自消化掉这个异常。</p>
<p>第二个问题显然才是它需要关心的事，但处理方式也绝不是当作没有错误发生并返回一个空字典或是 <code class="highlight"><span class="kc">None</span></code> 对象。正确的处理方式依然是向上抛出一个异常，这个异常可以是 <code class="highlight"><span class="ne">RuntimeError</span></code> 或是继承自它的自定义异常。</p>
<p>事实上，Python 标准库中的 json 库（<code class="highlight"><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">()</span></code> 函数）便是这么做的。</p>
<ul>
<li>
<p><code>如果文件不存在，函数怎么办？</code></p>
<p>不可能在 <code class="highlight"><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">()</span></code> 函数中触发该异常，因为它并不直接读取文件，而是只使用传递到参数的文件指针，即它的第一个形参：<code class="highlight"><span class="n">fp</span><span class="p">:</span> <span class="n">SupportsRead</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="nb">bytes</span><span class="p">]</span></code>。</p>
<p>而引发 <code class="highlight"><span class="ne">FileNotFoundError</span></code> 异常的函数通常是构造文件指针的函数，即 <code class="highlight"><span class="nb">open</span><span class="p">()</span></code> 函数。</p>
</li>
<li>
<p><code>如果文件内容不是一个 json 字符串，函数怎么办？</code></p>
<p><code class="highlight"><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">()</span></code> 会向上抛出 <code class="highlight"><span class="n">json</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">JSONDecodeError</span></code> 异常，而绝不是私自消化它。</p>
</li>
</ul>
<p>一个私自消化不该处理的异常的函数，就像是一个唯唯诺诺的小男孩，当受到了欺负的时候，被家长问起来也只是一问三不知，丝毫不透露自己发生了什么事情。</p>
<p>只有当你很明确这个函数该消化这个异常的时候，才去处理它，不该消化的时候，记得直接向上抛出！只有这样，Python 的 traceback 才能更加清晰地显示出错的原因。</p>
<h3 id="46">4.6 不要为了炫技而故意降低代码可读性<a class="headerlink" href="#46" title="Permanent link">&para;</a></h3>
<div class="admonition cite">
<p class="admonition-title">引用</p>
<p>代码的阅读频率远高于编写代码的频率。</p>
<p>Code is read much more often than it is written.</p>
<p>—— Python 创始人 Guido van Rossum（原文见 <a href="https://peps.python.org/pep-0008/#a-foolish-consistency-is-the-hobgoblin-of-little-minds">PEP-8</a>）</p>
</div>
<p>写出很酷的代码的确是一件振奋人心的事情，但这不意味着你需要将其写成只有你自己才能看懂的样子。一份好的代码，不仅需要阐述清晰、没有歧义、便于理解、逻辑正确，还需要有很好的可读性和可维护性。</p>
<ul>
<li>可读性：接近自然语言或者习语，不需要过多思维转换和脑补便能看懂代码逻辑，而非不明觉厉。</li>
<li>可维护性：代码逻辑由多个独立组件构成，耦合度低，便于维护和修改，一个组件的修改不会对其他组件造成太大影响。</li>
</ul>
<p>当他人阅读你写的代码时，你应当设法让人家因为代码的语句优美、构思精妙、思虑缜密而大呼 “卧槽”，而不是让人家因为代码的晦涩难懂而大骂 “我操”。以下是一些故意降低代码可读性的示例：</p>
<p>典型 1：故意进行不必要的代码压缩</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>注意：下方的 <code class="highlight"><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">iterables</span><span class="p">)</span></code> 函数的用途是将多个可迭代对象合并成一个迭代器。</p>
<p>Good:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_command_list_for_type</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">type_</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">_T</span><span class="p">],</span>
        <span class="n">search_in_timing_group</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">exclude_noinput</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return an iterator of commands of the given type.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">type_</span> <span class="o">==</span> <span class="n">ArcTap</span><span class="p">:</span>
        <span class="n">list_of_arctap_list</span> <span class="o">=</span> <span class="p">(</span><span class="n">arc</span><span class="o">.</span><span class="n">arctap_list</span> <span class="k">for</span> <span class="n">arc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">command_list</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arc</span><span class="p">,</span> <span class="n">Arc</span><span class="p">))</span>
        <span class="n">list_in_chart</span> <span class="o">=</span> <span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">list_of_arctap_list</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">list_in_chart</span> <span class="o">=</span> <span class="p">(</span><span class="n">command</span> <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">command_list</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">type_</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">search_in_timing_group</span><span class="p">:</span>
        <span class="n">list_of_cmd_list_from_timing_group</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">timing_group</span><span class="o">.</span><span class="n">get_command_list_for_type</span><span class="p">(</span>
                <span class="n">type_</span><span class="p">,</span>
                <span class="n">search_in_timing_group</span><span class="p">,</span>
                <span class="n">exclude_noinput</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">timing_group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_command_list_for_type</span><span class="p">(</span><span class="n">TimingGroup</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">list_in_timing_group</span> <span class="o">=</span> <span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">list_of_cmd_list_from_timing_group</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">chain</span><span class="p">(</span><span class="n">list_in_chart</span><span class="p">,</span> <span class="n">list_in_timing_group</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">list_in_chart</span>
</code></pre></div>
<p>Bad:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_command_list_for_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">_T</span><span class="p">],</span> <span class="n">search_in_timing_group</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">exclude_noinput</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">_T</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return an iterator of commands of the given type.&quot;&quot;&quot;</span>
    <span class="n">list_in_chart</span> <span class="o">=</span> <span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">arc</span><span class="o">.</span><span class="n">arctap_list</span> <span class="k">for</span> <span class="n">arc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">command_list</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arc</span><span class="p">,</span> <span class="n">Arc</span><span class="p">)))</span> <span class="k">if</span> <span class="n">type_</span> <span class="o">==</span> <span class="n">ArcTap</span> <span class="k">else</span> <span class="p">(</span><span class="n">command</span> <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">command_list</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">type_</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">list_in_chart</span> <span class="k">if</span> <span class="n">search_in_timing_group</span> <span class="k">else</span> <span class="n">chain</span><span class="p">(</span><span class="n">list_in_chart</span><span class="p">,</span> <span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">timing_group</span><span class="o">.</span><span class="n">get_command_list_for_type</span><span class="p">(</span><span class="n">type_</span><span class="p">,</span> <span class="n">search_in_timing_group</span><span class="p">,</span> <span class="n">exclude_noinput</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">)</span> <span class="k">for</span> <span class="n">timing_group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_command_list_for_type</span><span class="p">(</span><span class="n">TimingGroup</span><span class="p">))))</span>
</code></pre></div>
</div>
<p>可读性几乎为 0，我知道这个函数可以三行写完，但是何必呢？考研英语长难句我已经看得够多了，到了 Python 这里还需要我再来帮你划一下句子成分和从句吗？</p>
<p>典型 2：滥用语法糖</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>Good:</p>
<div class="highlight"><pre><span></span><code><span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;the fox jumped over the lazy dog&#39;</span>
<span class="n">new_msg_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">msg</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
        <span class="n">new_msg_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_msg_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">chr</span><span class="p">((</span><span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">)</span> <span class="o">-</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">26</span> <span class="o">+</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)))</span>

<span class="n">new_msg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_msg_list</span><span class="p">)</span>
</code></pre></div>
<p>Bad:</p>
<div class="highlight"><pre><span></span><code><span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;the quick brown fox jumps over the lazy dog&#39;</span>
<span class="n">new_msg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">char</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39; &#39;</span> <span class="ow">or</span> <span class="nb">chr</span><span class="p">((</span><span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">)</span> <span class="o">-</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">26</span> <span class="o">+</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">msg</span><span class="p">)</span>
</code></pre></div>
</div>
<p>滥用语法糖的最大问题是，对非 Python 使用者非常不友好。请注意，你所写的代码不仅仅是给 Python 使用者看的，同时也是给所有人看的。</p>
<p>这就像你用文言文写出一段非常<strong>优雅</strong>（？）的小作文，然后拿给中文不熟练的国际友人看，并问他 “嘿老外，看看我写的文章，多么优雅！”，人家可能并不会觉得你优雅，甚至会觉得你有什么大病。</p>
<p>为了让所有人都能看懂，有个时候不得不放弃一些较为 Pythonic 的写法。</p>
<p>例如这里的</p>
<div class="highlight"><pre><span></span><code><span class="n">A</span> <span class="k">if</span> <span class="n">condition</span> <span class="k">else</span> <span class="n">f</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="k">for</span> <span class="n">B</span> <span class="ow">in</span> <span class="n">list_of_B</span>
</code></pre></div>
<p>是一个非常 Pythonic 的语法糖，对于 Python 使用者来说这几乎没什么，甚至非常棒，但是对非 Python 使用者来说，阅读该段代码简直和坐牢一样。</p>
<div class="admonition tip">
<p class="admonition-title">提示</p>
<p>这里用到了两个语法糖：</p>
<ul>
<li>Python 三元运算符（参见 <a href="https://docs.python.org/zh-cn/3/reference/expressions.html#conditional-expressions">条件表达式</a>、<a href="https://peps.python.org/pep-0308/">PEP-308</a>）</li>
<li>Python 生成器表达式（参见 <a href="https://docs.python.org/zh-cn/3/reference/expressions.html#generator-expressions">生成器表达式</a>、<a href="https://docs.python.org/zh-cn/3/tutorial/datastructures.html#list-comprehensions">列表推导式</a>）</li>
</ul>
</div>
<p>纠结的问题在于它的执行顺序是</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">A</span> <span class="k">if</span> <span class="n">condition</span> <span class="k">else</span> <span class="n">f</span><span class="p">(</span><span class="n">B</span><span class="p">))</span> <span class="k">for</span> <span class="n">B</span> <span class="ow">in</span> <span class="n">list_of_B</span>
</code></pre></div>
<p>还是</p>
<div class="highlight"><pre><span></span><code><span class="n">A</span> <span class="k">if</span> <span class="n">condition</span> <span class="k">else</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="k">for</span> <span class="n">B</span> <span class="ow">in</span> <span class="n">list_of_B</span><span class="p">)</span>
</code></pre></div>
<p>（事实上前者是正确的执行顺序）</p>
<p>因此，在你费尽心思用语法糖写出一些让人不明觉厉代码的同时，也请关照一下不使用你这种语言的开发者。当然，如果你写的时候就没想着让非 Python 使用者看懂，那你也可以忽略这一条。</p>
<p>典型 3：滥用魔法方法</p>
<p>Python 的强大之处在于，它对 <code>对象</code> 提供了各种各样丰富的 <a href="https://pyzh.readthedocs.io/en/latest/python-magic-methods-guide.html">魔法方法</a>。对于 Python 新手，可以将魔法方法理解为 Python 对 <code>对象</code> 的运算符重载。得益于 Python <code>一切皆对象</code> 的世界观，你可以借助这些魔法在整个 Python 世界中实现各种各样的奇技淫巧。</p>
<p>和其他所有支持运算符重载的语言不同，你在 Python 代码中能见到的几乎所有运算符都可以无需顾虑地直接重载（赋值运算符 <code>=</code> 除外），这也是为什么唯独只有 Python 将 <code>运算符重载</code> 称为 <code>魔法方法</code>。</p>
<p>除了那些大部分语言都可以实现的经典运算符重载外，你还可以：</p>
<ul>
<li>逻辑运算符重载：例如使用 <code>__xor__(self, other)</code> 重新定义实现按位异或运算符 <code>^</code> 的行为。</li>
<li>增强赋值运算符重载：例如使用 <code>__iadd__(self, other)</code> 重新定义 <code>+=</code> 的行为。</li>
<li>一元操作符重载：例如使用 <code>__neg__(self)</code> 方法重新定义取负操作 <code>-xxx</code> 的行为；例如使用<code>__abs__(self)</code> 方法重新定义该对象被绝对值函数 <code>abs()</code> 调用时的行为</li>
<li>类型转换操作符重载：例如使用 <code>__int__(self)</code> 方法重新定义该对象被取整函数 <code>int()</code> 调用时的行为，<code>__str__(self)</code> 等同理。</li>
<li>访问控制操作符重载：例如使用 <code>__getattr__(self, item)</code> 方法重新定义 <code>.</code> 的行为，当且仅当用户访问一个不存在的属性时触发， <code>__setattr__(self, key, value)</code> 等同理。</li>
<li>序列操作符重载：例如使用 <code>__getitem__(self, key)</code> 方法重新定义 <code>[</code> 的行为，<code>__setitem__(self, key, value)</code> 等同理。</li>
<li>...</li>
</ul>
<p>除了上面提到的运算符重载以外，你还可以：</p>
<ul>
<li>成员运算符重载：使用 <code>__contains__(self, item)</code> 方法重新定义成员运算符 <code>in</code> 的行为。</li>
<li>可调用对象操作符重载：例如使用 <code>__call__(self, *args, **kwargs)</code> 方法重新定义该对象被调用时的行为。</li>
<li>变身成为上下文管理器：定义 <code>__enter__(self)</code> 和 <code>__exit__(self, exception_type, exception_value, traceback)</code> 方法后，可对该对象使用 <code class="highlight"><span class="k">with</span></code> 语句。（异步时使用 <code>__aenter__</code> 和 <code>__aexit__</code>）</li>
<li>变身成为协程：定义了 <code>__await__(self)</code> 方法的对象是可等待对象。</li>
<li>创建描述符对象：例如使用 <code>__get__(self, instance, owner)</code> 定义当试图取出描述符（类属性或实例属性）的值时的行为。</li>
<li>...</li>
</ul>
<p>（上述提到的魔法方法仅仅是 Python 所有的魔法方法中的冰山一角，如果感兴趣可以参考官方 <a href="https://docs.python.org/zh-cn/3/reference/datamodel.html#special-method-names">文档</a>）</p>
<p>和 <a href="#31">3.1 使用<strong>优美</strong>的现有方法取代<strong>丑陋</strong>的自行实现</a> 中提到的并无冲突，本节所述的内容是<strong>不要滥用</strong>魔法方法。如果你为了实现一个目标需要大量地使用魔法方法，或许你应该考虑一下 Python 标准库或者第三方库。</p>
<p>例如你需要重载大量序列操作符和关系运算符以实现一个自定义的数据结构。可是你有没有想过一种可能——说不定你所需要实现的这个数据结构早就在 Python 标准库 <a href="https://docs.python.org/zh-cn/3/library/collections.html"><code>collections</code></a> 里帮你定义好了呢？</p>
<p>作为一个 Python 开发者，这些魔法方法为我们的代码带来了几乎无限的可能性，那无与伦比的强大的功能让我们不再惧怕任何难以实现的目标。</p>
<p>然而，能力越强责任越大，知道这些魔法方法什么时候该用，什么时候不该用，对于我们来说才是最重要的。</p>
<p>就像功夫大师一样，一个 Pythonista 知道如何用一个手指杀死对方，但他从不会那么去做。</p>

    <!-- Last update of source file -->
    
        
            






  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最后更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime" title="2025年5月1日 05:16:48 UTC">2025-05-01 05:16:48</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="创建日期">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime" title="2022年5月30日 05:33:08 UTC">2022-05-30 05:33:08</span>
  </span>

    
    
    
  </aside>

        
    

    

        <!-- Giscus -->
        <h2 id="__comments">评论</h2>
        <script src="https://giscus.app/client.js"
                data-repo="zhanbao2000/blog"
                data-repo-id="R_kgDOHIZK7A"
                data-category="Announcements"
                data-category-id="DIC_kwDOHIZK7M4COdSe"
                data-mapping="pathname"
                data-reactions-enabled="1"
                data-emit-metadata="0"
                data-input-position="top"
                data-theme="light"
                data-lang="zh-CN"
                data-loading="lazy"
                crossorigin="anonymous"
                async>
        </script>

        <!-- Reload on palette change -->
        <script>
            var palette = __md_get("__palette");
            if (palette && typeof palette.color === "object")
                if (palette.color.scheme === "slate") {
                    const giscus = document.querySelector("script[src*=giscus]");
                    giscus.setAttribute("data-theme", "transparent_dark")
                }

            /* Register event handlers after documented loaded */
            document.addEventListener("DOMContentLoaded", function() {
                const ref = document.querySelector("[data-md-component=palette]");
                ref.addEventListener("change", function() {
                    const palette = __md_get("__palette");
                    if (palette && typeof palette.color === "object") {
                        const theme = palette.color.scheme === "slate" ? "transparent_dark" : "light";

                        /* Instruct Giscus to change theme */
                        const frame = document.querySelector(".giscus-frame");
                        frame.contentWindow.postMessage(
                            { giscus: { setConfig: { theme } } },
                            "https://giscus.app"
                        )
                    }
                })
            })
        </script>

    


              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../220511-how-to-write-python-into-classical-chinese/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 如何将 Python 写成文言文">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                如何将 Python 写成文言文
              </div>
            </div>
          </a>
        
        
          
          <a href="../220530-auto-sign-in-guide/" class="md-footer__link md-footer__link--next" aria-label="下一页: 自动签到使用指南">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                自动签到使用指南
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2077 Akiba Arisa <a href="https://icp.gov.moe/?keyword=20232033" target="_blank">萌ICP备20232033号</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/zhanbao2000" target="_blank" rel="noopener" title="AkibaArisa on GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="https://steamcommunity.com/id/akibaarisa" target="_blank" rel="noopener" title="AkibaArisa on Steam" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M496 256c0 137-111.2 248-248.4 248-113.8 0-209.6-76.3-239-180.4l95.2 39.3c6.4 32.1 34.9 56.4 68.9 56.4 39.2 0 71.9-32.4 70.2-73.5l84.5-60.2c52.1 1.3 95.8-40.9 95.8-93.5 0-51.6-42-93.5-93.7-93.5s-93.7 42-93.7 93.5v1.2L176.6 279c-15.5-.9-30.7 3.4-43.5 12.1L0 236.1C10.2 108.4 117.1 8 247.6 8 384.8 8 496 119 496 256M155.7 384.3l-30.5-12.6a52.8 52.8 0 0 0 27.2 25.8c26.9 11.2 57.8-1.6 69-28.4 5.4-13 5.5-27.3.1-40.3S206 305.6 193 300.2c-12.9-5.4-26.7-5.2-38.9-.6l31.5 13c19.8 8.2 29.2 30.9 20.9 50.7-8.3 19.9-31 29.2-50.8 21m173.8-129.9c-34.4 0-62.4-28-62.4-62.3s28-62.3 62.4-62.3 62.4 28 62.4 62.3-27.9 62.3-62.4 62.3m.1-15.6c25.9 0 46.9-21 46.9-46.8 0-25.9-21-46.8-46.9-46.8s-46.9 21-46.9 46.8c.1 25.8 21.1 46.8 46.9 46.8"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.footer", "navigation.tabs", "navigation.top", "navigation.tracking", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
        <script src="../../../javascripts/counter.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../../../javascripts/waifu/autoload.js" async></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": false, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>